#!/bin/bash
# Unified Automated Penetration Testing Script with Single IP

# Function to run Nmap Scan
run_nmap_scan() {
    echo "Running Nmap Scan on $target_ip..."
    
    # Run Nmap scan with aggressive scan and save to results file
    nmap -A -T4 $target_ip -oN nmap_scan_results.txt
    echo "Nmap scan complete. Results saved in nmap_scan_results.txt."
}

# Function to run tcpdump Capture
run_tcpdump_capture() {
    echo "Running tcpdump Capture on interface $interface for target IP: $target_ip..."
    
    # Run tcpdump to capture traffic related to the target IP
    sudo tcpdump host $target_ip -i $interface -c $packet_count -w tcpdump_capture.pcap
    echo "Packet capture complete. File saved as tcpdump_capture.pcap."
}

# Function to run Wireshark (Tshark) Capture
run_wireshark_capture() {
    echo "Running Wireshark (Tshark) Capture on interface $interface for target IP: $target_ip..."
    
    # Run Tshark to capture traffic related to the target IP
    tshark -i $interface -f "host $target_ip" -a duration:$duration -w wireshark_capture.pcap
    echo "Wireshark capture complete. File saved as wireshark_capture.pcap."
}

# Function to run Metasploit Scan
run_metasploit_scan() {
    echo "Running Metasploit Vulnerability Scan on $target_ip..."
    
    # Run Metasploit to scan for SMB vulnerabilities on the target IP
    msfconsole -q -x "use auxiliary/scanner/smb/smb_version; set RHOSTS $target_ip; run; exit"
    echo "Metasploit scan complete."
}

# Main function to orchestrate the testing steps
run_penetration_test() {
    echo "========================="
    echo " Automated Pentesting Script "
    echo "========================="
    
    # Get the target IP
    echo "Enter the target IP:"
    read target_ip
    
    # Get the network interface to use
    echo "Enter the network interface (e.g., eth0):"
    read interface
    
    # Get the number of packets to capture for tcpdump
    echo "Enter the number of packets to capture:"
    read packet_count
    
    # Get the capture duration for Wireshark (in seconds)
    echo "Enter the capture duration (in seconds):"
    read duration
    
    # Step 1: Nmap Scan
    run_nmap_scan
    
    # Step 2: tcpdump Capture
    run_tcpdump_capture
    
    # Step 3: Wireshark (Tshark) Capture
    run_wireshark_capture
    
    # Step 4: Metasploit Vulnerability Scan
    run_metasploit_scan
    
    echo "========================="
    echo " All Penetration Testing Tasks Complete! "
    echo "========================="
}

# Execute the penetration test
run_penetration_test

